<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Создать место</title>
<script src="https://api-maps.yandex.ru/2.1/?apikey=ваш_ключ_api&lang=ru_RU" type="text/javascript"></script>
</head>
<body>

<!-- Форма для создания места -->
<form id="placeForm" enctype="multipart/form-data">
    <label for="name">Название:</label>
    <input type="text" id="name" name="name" required><br>

    <label for="short_description">Краткое описание:</label>
    <input type="text" id="short_description" name="short_description"><br>

    <label for="full_description">Полное описание:</label><br>
    <textarea id="full_description" name="full_description"></textarea><br>

    <label for="how_to_get">Как добраться:</label>
    <input type="text" id="how_to_get" name="how_to_get"><br>

    <label for="address">Адрес:</label>
    <input type="text" id="address" name="address"><br>

    <label for="rating">Рейтинг:</label>
    <input type="number" id="rating" name="rating" min="1" max="5"><br>

    <label for="latitude">Широта:</label>
    <input type="text" id="latitude" name="latitude"><br>

    <label for="longitude">Долгота:</label>
    <input type="text" id="longitude" name="longitude"><br>

    <label for="tags">Теги:</label>
    <input type="text" id="tags" name="tags"><br>

    <!-- Контейнер для карты -->
    <div id="map" style="width: 100%; height: 400px;"></div><br>

    <!-- Поле для вложений (пустое) -->
    <input type="file" id="attachments" name="attachments" style="display:none;"><br>

    <button type="button" onclick="submitPlace()">Создать место</button>
</form>

<script>
function submitPlace() {
    var form = document.getElementById('placeForm');
    var formData = new FormData(form);
    
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'http://localhost:8080/api/v1/places', true);
    xhr.setRequestHeader('Authorization', 'Bearer ${token}');
    xhr.setRequestHeader('Accept', '*/*');
    
    xhr.onload = function() {
        if (xhr.status >= 200 && xhr.status < 300) {
            console.log('Место успешно создано:', xhr.responseText);
            alert('Место успешно создано!');
            form.reset(); // Очистить форму после успешного создания места
        } else {
            console.error('Ошибка при создании места:', xhr.statusText);
            alert('Произошла ошибка при создании места!');
        }
    };
    
    xhr.onerror = function() {
        console.error('Произошла ошибка при выполнении запроса');
        alert('Произошла ошибка при создании места!');
    };
    
    xhr.send(formData);
}

// Инициализация карты Яндекса
ymaps.ready(initMap);

function initMap() {
    var myMap = new ymaps.Map('map', {
        center: [55.751574, 37.573856],
        zoom: 10
    });

    // Обработчик клика на карте
    myMap.events.add('click', function (e) {
        var coords = e.get('coords');
        // Записываем координаты в поля формы
        document.getElementById('latitude').value = coords[0].toPrecision(6);
        document.getElementById('longitude').value = coords[1].toPrecision(6);
        // Удаляем предыдущую метку
        myMap.geoObjects.removeAll();
        // Создаем новую метку
        var placemark = new ymaps.Placemark(coords, {}, {
            draggable: true
        });
        // Добавляем метку на карту
        myMap.geoObjects.add(placemark);
        // Обработчик изменения положения метки
        placemark.events.add('dragend', function () {
            var newCoords = placemark.geometry.getCoordinates();
            document.getElementById('latitude').value = newCoords[0].toPrecision(6);
            document.getElementById('longitude').value = newCoords[1].toPrecision(6);
        });
    });
}
</script>

</body>
</html>
